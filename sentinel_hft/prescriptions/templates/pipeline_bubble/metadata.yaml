# Pipeline Bubble FixPack Template Metadata
# Pattern: PIPELINE_BUBBLE
# Version: 1.0.0

id: "pipeline_bubble_bypass"
name: "Pipeline Bypass Network"
version: "1.0.0"
pattern_id: "PIPELINE_BUBBLE"

description: |
  Data forwarding network with hazard detection to eliminate pipeline stalls.
  Implements bypass paths for RAW hazards and structural hazard avoidance.

problem_statement: |
  Pipeline stalls occur when data dependencies between stages cannot be resolved
  without waiting. Classic example: instruction N needs result from N-1, but
  N-1 hasn't written back yet. Each bubble adds 1+ cycles of latency.

solution_approach: |
  Implement forwarding/bypass network that routes results directly from
  producer stage to consumer stage, bypassing intermediate registers.
  Add hazard detection to identify when bypassing is needed vs. stalling.

parameters:
  - name: NUM_STAGES
    description: "Number of pipeline stages"
    type: int
    default: 4
    min_value: 2
    max_value: 8

  - name: DATA_WIDTH
    description: "Data path width in bits"
    type: int
    default: 64
    min_value: 32
    max_value: 256

  - name: NUM_OPERANDS
    description: "Number of source operands per operation"
    type: int
    default: 2
    min_value: 1
    max_value: 4

  - name: REG_ADDR_WIDTH
    description: "Register address width"
    type: int
    default: 5
    min_value: 3
    max_value: 8

  - name: ENABLE_FULL_BYPASS
    description: "Enable bypass from all stages"
    type: bool
    default: true

  - name: STALL_ON_LOAD
    description: "Stall on load-use hazard (cannot forward)"
    type: bool
    default: true

fpga_resources:
  - vendor: xilinx
    family: "ultrascale+"
    luts: 350
    ffs: 200
    bram_18k: 0
    bram_36k: 0
    dsp: 0
    max_freq_mhz: 450
    latency_cycles: 0
    notes: "4-stage, 2-operand, full bypass"

  - vendor: intel
    family: "agilex"
    luts: 380
    ffs: 210
    bram_18k: 0
    bram_36k: 0
    dsp: 0
    max_freq_mhz: 420
    latency_cycles: 0
    notes: "4-stage, 2-operand, full bypass"

expected_latency_reduction_pct: 30.0
expected_throughput_improvement_pct: 20.0
confidence_range: [55, 80]

rtl_template: "pipeline_bypass.sv.j2"
testbench_template: "pipeline_bypass_tb.sv.j2"
integration_guide_template: "integration_guide.md.j2"

prerequisites:
  - "Pipeline must have clear stage boundaries"
  - "Register file with read-during-write capability"
  - "Hazard signals must be available from decode stage"

breaking_changes:
  - "Adds combinational paths between non-adjacent stages"
  - "May require retiming for high frequencies"

known_limitations:
  - "Load-use hazards still require 1 stall cycle"
  - "Complex multi-cycle operations may need special handling"

min_test_vectors: 1500
recommended_test_duration_ms: 150
