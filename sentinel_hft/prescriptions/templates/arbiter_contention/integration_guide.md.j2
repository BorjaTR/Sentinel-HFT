# Integration Guide: Weighted Round-Robin Arbiter

> **Generated by Sentinel-HFT FixPack Generator**
> Pattern: ARBITER_CONTENTION
> Generated: {{ metadata.generation_timestamp }}

## Overview

This fix addresses **arbiter contention** detected in your latency trace. The weighted round-robin arbiter provides fair access to shared resources while respecting traffic priorities.

### Problem Statement

{{ metadata.problem_statement }}

### Solution Approach

{{ metadata.solution_approach }}

## Parameters Used

| Parameter | Value | Description |
|-----------|-------|-------------|
| NUM_PORTS | {{ params.NUM_PORTS }} | Number of requester ports |
| DATA_WIDTH | {{ params.DATA_WIDTH }} | Data path width in bits |
| WEIGHT_WIDTH | {{ params.WEIGHT_WIDTH }} | Bits for weight counter |
| ENABLE_PRIORITY_ESCALATION | {{ params.ENABLE_PRIORITY_ESCALATION }} | Starvation prevention |
| ESCALATION_THRESHOLD | {{ params.ESCALATION_THRESHOLD }} | Cycles before priority boost |
| SINGLE_CYCLE_GRANT | {{ params.SINGLE_CYCLE_GRANT }} | Fast path for single requester |

## Expected Impact

- **Latency Reduction**: ~{{ metadata.expected_latency_reduction_pct }}%
- **Throughput Improvement**: ~{{ metadata.expected_throughput_improvement_pct }}%

## Integration Steps

### Step 1: Replace Existing Arbiter

```systemverilog
// Before (simple round-robin):
round_robin_arbiter #(.N({{ params.NUM_PORTS }})) u_arb (
    .clk(clk),
    .rst_n(rst_n),
    .req(requests),
    .grant(grants)
);

// After (weighted round-robin):
weighted_rr_arbiter #(
    .NUM_PORTS({{ params.NUM_PORTS }}),
    .DATA_WIDTH({{ params.DATA_WIDTH }}),
    .WEIGHT_WIDTH({{ params.WEIGHT_WIDTH }}),
    .ENABLE_ESCALATION({{ '1' if params.ENABLE_PRIORITY_ESCALATION else '0' }}),
    .ESCALATION_THRESHOLD({{ params.ESCALATION_THRESHOLD }}),
    .SINGLE_CYCLE_GRANT({{ '1' if params.SINGLE_CYCLE_GRANT else '0' }})
) u_arb (
    .clk(clk),
    .rst_n(rst_n),
    .req(requests),
    .req_data(request_data),
    .grant(grants),
    .weights(port_weights),
    .grant_data(arb_data_out),
    .grant_valid(arb_valid),
    .grant_ready(downstream_ready),
    .current_winner(winner_port),
    .starvation_warning(starvation_alert)
);
```

### Step 2: Configure Weights

Set weights based on expected traffic patterns:

```systemverilog
// Example: Market data port gets 4x weight vs order ports
assign port_weights[0] = 4'd4;  // Market data
assign port_weights[1] = 4'd1;  // Orders
assign port_weights[2] = 4'd1;  // Fills
assign port_weights[3] = 4'd2;  // Risk updates
```

### Step 3: Handle Starvation Warnings

```systemverilog
// Monitor for starvation conditions
always_ff @(posedge clk) begin
    if (|starvation_warning) begin
        // Log or alert - indicates weight imbalance
        $display("Starvation warning on ports: %b", starvation_warning);
    end
end
```

## Verification Checklist

- [ ] All testbench scenarios pass
- [ ] Weight distribution matches expected ratios
- [ ] No starvation under continuous load
- [ ] Single-requester latency is 1 cycle
- [ ] Backpressure handled correctly

---

**CANDIDATE FIX - Review Required Before Use**
